
{% extends "base.html" %}

{% block content %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script>
        const updateChat = () => {               //GET MESSAGE FUNCTION TO UDATE MESSAGES
            fetch("updateM")
                .then((response) => response.json())
                .then((convos) => {
                    let messagesHtml = "";
                    for (var conversation of convos.response) {
                        messagesHtml += `<button onclick="setgmID(\''+${ conversation.group_id }+'\')"> <h3 style="text-align:left;color:white"> ${ conversation.name } <span style="float:right"> ${ conversation.time } </span> </h3> <h4 style="text-align:left">${ conversation.platform }</h4> <p style="text-align:left"> ${ conversation.snippet } </p> </button>`
                    }

                    let msgGroup = document.getElementById("msgGroup");
                    msgGroup.innerHTML = messagesHtml;
                })
                .catch((err) => console.log(err));
        }
        setInterval(updateChat, 500);  
        
        function setgmID(id){

            $.ajax({
                type: "POST",
                url: "{{ 'updategmID/' }}",
                data: { csrfmiddlewaretoken: '{{ csrf_token }}', text: id },  
            });
        }

    </script>
    <section class="header">
        <nav id="mynavbar" class="navbar">
            <a id="navname"> <b>UniformChat</b> </a>
            <a href="../" id="chat">Chat</a>
            <a href="" id="messages">Messages</a>
            <a href="../gmlogin" id="gmlogin">GroupMe Login</a>
        </nav>
    </section>
    <container class="convcont">
        <div class="toolbox">
            <button class="newconvo">+</button>
            <button class="settings">Settings</button>
        </div>
        <div class="btn-group">
            <div id = "msgGroup">
                {% for conversation in conversations %}
                <button id="cbutton" onclick="gotoChat();">
                    <h3 style="text-align:left;color:white">

                        {{ conversation.name }}
                        <span style="float:right">
                            {{ conversation.usedate }}
                        </span>
                    </h3>
                    <h4 style="text-align:left">{{ conversation.platform }}</h4>
                    <p style="text-align:left"> {{ conversation.snippet }} </p>
                </button>
                {% endfor %}
            </div>
        </div>
    </container>
{% endblock %}